# GPT Branch Tree Navigator 项目优化分析

## 性能优化
- **延迟加载分支数据**：当前 `renderTreeGradually` 逐批渲染节点，建议在数据量巨大时增加“分页/层级折叠默认关闭”开关，进一步降低首屏渲染压力。
- **缓存后端 mapping**：`fetchMapping` 每次刷新都会重新拉取，可在 `localStorage` 增加带时间戳的缓存，在会话未变化时直接复用以减少网络请求。
- **DOM 查询范围收紧**：`harvestLinearNodes` 每次都会遍历所有消息块，可以通过观察 `MutationObserver` 回调中的 `addedNodes/removedNodes` 精准更新，避免全量扫描。

## 代码结构优化
- **拆分模块**：目前所有逻辑集中在一个文件中，可拆分为配置、UI、数据、导航四个模块，便于维护与单元测试。
- **类型约束**：引入 TypeScript 或 JSDoc 注释声明 `NodeRecord`、`TreeNode` 等接口，提高 IDE 智能提示与重构安全性。
- **统一工具函数**：`normalize`、`hash` 等工具函数可抽离到 `utils`，避免重复定义并便于复用。

## 交互体验优化
- **节点悬停预览**：支持鼠标悬停时展示文本摘要 tooltip，无需点击即可快速浏览内容。
- **分支内容聚合**：在节点列表中补充“兄弟分支预览”或“最近更新”标识，帮助用户快速了解其它分支的上下文。
- **快捷键自定义**：提供偏好设置让用户自定义 Alt+T、Alt+M 等快捷键，提升可定制性。
- **Markdown 语义增强**：当前模态已支持标题、列表、代码块等基础 Markdown 渲染，可进一步扩展表格、引用块与任务列表等语法，并提供主题色适配方案。

## 稳定性与容错
- **鉴权失效处理**：在 `ensureAuth` 中捕获 401/403 并提示用户重新登录，避免静默失败。
- **请求重试**：为 `fetchMapping` 等网络请求增加指数退避重试策略，提升弱网环境的可靠性。
- **异常上报**：集成可选的日志上报接口，将关键错误发送至用户配置的监控端点，方便排查问题。
